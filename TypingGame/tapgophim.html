<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Game GÃµ PhÃ­m</title>
<style>
  /* ğŸŒˆ Ná»n Ä‘á»™ng gradient */
  body {
    font-family: "Segoe UI", sans-serif;
    background: linear-gradient(120deg, #a1c4fd, #c2e9fb);
    background-size: 200% 200%;
    animation: gradientMove 10s ease infinite;
    text-align: center;
    padding-top: 40px;
    overflow: hidden;
    transition: background 0.5s, color 0.5s;
  }

  @keyframes gradientMove {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  body.dark {
    background: linear-gradient(120deg, #141E30, #243B55);
    color: #f5f5f5;
  }

  /* ğŸ’« Floating blur balls */
  .blur-ball {
    position: absolute;
    border-radius: 50%;
    filter: blur(100px);
    opacity: 0.45;
    animation: float 10s ease-in-out infinite alternate;
  }
  @keyframes float {
    from { transform: translateY(0); }
    to { transform: translateY(-50px); }
  }

  .ball1 { background: #ffb6b9; width: 250px; height: 250px; top: 5%; left: 10%; }
  .ball2 { background: #c2e9fb; width: 300px; height: 300px; bottom: 10%; right: 8%; }
  .ball3 { background: #bbded6; width: 200px; height: 200px; bottom: 15%; left: 40%; }

  /* ğŸ§± Container */
  #container {
    position: relative;
    width: 80%;
    max-width: 900px;
    margin: auto;
    background: rgba(255,255,255,0.9);
    padding: 25px;
    border-radius: 16px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.2);
    z-index: 2;
  }
  body.dark #container { background: rgba(30,30,40,0.9); }

  #topBar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
  }

  #leftOptions select {
    font-size: 16px;
    padding: 6px 10px;
    margin-right: 8px;
    border-radius: 6px;
  }

  #logoutBtn {
    background-color: #ff4d4d;
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 16px;
    transition: background-color 0.2s;
  }
  #logoutBtn:hover { background-color: #cc0000; }

  #themeIcon, #volumeDown, #volumeUp {
    background: none;
    border: none;
    font-size: 22px;
    cursor: pointer;
    margin-right: 10px;
    transition: transform 0.2s;
    color: inherit;
  }
  #themeIcon:hover, #volumeDown:hover, #volumeUp:hover { transform: scale(1.2); }

  #volumeDisplay {
    font-size: 16px;
    margin-right: 10px;
    width: 40px;
    display: inline-block;
  }

  #textDisplay {
    font-size: 22px;
    line-height: 1.6;
    text-align: left;
    padding: 15px;
    background-color: #fefefe;
    border-radius: 8px;
    border: 2px solid #ddd;
    margin-bottom: 20px;
    min-height: 100px;
  }
  body.dark #textDisplay { background: #1f1f2e; border-color: #444; }

  .correct { color: #00b300; font-weight: bold; }
  .incorrect { background-color: #ff4d4d; color: white; }
  .done { color: #4d79ff; }
  .current-word span { padding: 0 1px; }

  #inputArea {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
  }

  #input {
    width: 70%;
    font-size: 22px;
    padding: 10px;
    border: 2px solid #007bff;
    border-radius: 6px;
    outline: none;
  }
  body.dark #input { background: #2a2a3d; color: white; border-color: #4d79ff; }

  #restartBtn {
    font-size: 26px;
    background: #007bff;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 8px 12px;
    cursor: pointer;
    transition: 0.2s;
  }
  #restartBtn:hover { background: #0056b3; }

  #stats { margin-top: 15px; font-size: 18px; }
  #result { margin-top: 25px; font-size: 20px; font-weight: bold; color: #007bff; }
</style>
</head>
<body>
  <div class="blur-ball ball1"></div>
  <div class="blur-ball ball2"></div>
  <div class="blur-ball ball3"></div>

  <div id="container">
    <div id="topBar">
      <div id="leftOptions">
        <select id="langSwitch">
          <option value="vi">ğŸ‡»ğŸ‡³ Tiáº¿ng Viá»‡t</option>
          <option value="en">ğŸ‡¬ğŸ‡§ English</option>
        </select>
        <select id="modeSwitch">
          <option value="word">ğŸ“ Luyá»‡n tá»«</option>
          <option value="fable">ğŸ“– Ngá»¥ ngÃ´n Viá»‡t Nam</option>
          <option value="challenge">âš¡ Thá»­ thÃ¡ch tá»‘c Ä‘á»™</option>
        </select>
      </div>

      <div id="rightOptions">
        <button id="volumeDown" title="Giáº£m Ã¢m lÆ°á»£ng">ğŸ”‰</button>
        <span id="volumeDisplay">100%</span>
        <button id="volumeUp" title="TÄƒng Ã¢m lÆ°á»£ng">ğŸ”Š</button>
        <button id="themeIcon">ğŸŒ™</button>
        <button id="logoutBtn">ğŸšª ÄÄƒng xuáº¥t</button>
      </div>
    </div>

    <div id="textDisplay"></div>
    <div id="inputArea">
      <input type="text" id="input" placeholder="Báº¯t Ä‘áº§u gÃµ táº¡i Ä‘Ã¢y..." autofocus>
      <button id="restartBtn" title="ChÆ¡i láº¡i">ğŸ”</button>
    </div>
    <div id="stats">
      â± <span id="time">60</span>s | âœ… <span id="correct">0</span> | âŒ <span id="incorrect">0</span>
    </div>
    <div id="result"></div>
  </div>

<script>
const textDisplay = document.getElementById("textDisplay");
const input = document.getElementById("input");
const timeDisplay = document.getElementById("time");
const correctDisplay = document.getElementById("correct");
const incorrectDisplay = document.getElementById("incorrect");
const resultDisplay = document.getElementById("result");
const restartBtn = document.getElementById("restartBtn");
const langSwitch = document.getElementById("langSwitch");
const modeSwitch = document.getElementById("modeSwitch");
const themeIcon = document.getElementById("themeIcon");
const volumeUp = document.getElementById("volumeUp");
const volumeDown = document.getElementById("volumeDown");
const volumeDisplay = document.getElementById("volumeDisplay");

let lang = "vi", mode = "word", words = [], currentWordIndex = 0;
let correctCount = 0, incorrectCount = 0, timeLeft = 60, timer = null;
let started = false, wrongWords = [], history = JSON.parse(localStorage.getItem("history") || "[]");

let volume = parseFloat(localStorage.getItem("volume") || "1");
volume = Math.min(1, Math.max(0, volume));

const soundCorrect = new Audio("https://assets.mixkit.co/active_storage/sfx/1068/1068-preview.mp3");
const soundWrong = new Audio("https://assets.mixkit.co/active_storage/sfx/1096/1096-preview.mp3");
soundCorrect.volume = volume;
soundWrong.volume = volume;
volumeDisplay.textContent = Math.round(volume * 100) + "%";

const fables = [
  "NgÃ y xÆ°a cÃ³ má»™t con rÃ¹a vÃ  má»™t con thá» cÃ¹ng thi cháº¡y. Thá» cháº¡y ráº¥t nhanh nÃªn ngá»§ quÃªn, cÃ²n rÃ¹a kiÃªn trÃ¬ bÃ² tá»›i Ä‘Ã­ch vÃ  giÃ nh chiáº¿n tháº¯ng.",
  "Má»™t láº§n ná», con quáº¡ khÃ¡t nÆ°á»›c tÃ¬m tháº¥y chiáº¿c bÃ¬nh. NÆ°á»›c trong bÃ¬nh Ã­t, quáº¡ bÃ¨n nháº·t sá»i bá» vÃ o, nÆ°á»›c dÃ¢ng lÃªn vÃ  nÃ³ uá»‘ng Ä‘Æ°á»£c.",
  "NgÆ°á»i nÃ´ng dÃ¢n cá»©u con ráº¯n bá»‹ láº¡nh, ráº¯n tá»‰nh láº¡i liá»n cáº¯n ngÆ°á»i cá»©u nÃ³. BÃ i há»c: khÃ´ng nÃªn giÃºp káº» xáº¥u."
];

function generateWords(lang, mode) {
  if (mode === "fable") return fables[Math.floor(Math.random() * fables.length)].split(" ");
  const base_vi = "tia náº¯ng mÆ°a tÃ´i cÃ´ nháº¡c cáº§u Ä‘Æ°á»ng ngÃ nh chá»‹ anh giÃ³ biá»ƒn trá»i hoa vÃ ng Ã¡nh sÃ¡ng bÃ¬nh minh háº¡nh phÃºc Æ°á»›c mÆ¡ há»c trÃ² thá»i gian Ä‘am mÃª".split(" ");
  const base_en = "sun light rain happy time sound music peace love code typing word fast challenge dream hope success".split(" ");
  const base = lang === "vi" ? base_vi : base_en;
  return Array.from({ length: mode === "challenge" ? 100 : 500 }, () => base[Math.floor(Math.random() * base.length)]);
}

function renderText() {
  const visible = words.slice(currentWordIndex, currentWordIndex + 20);
  const done = words.slice(0, currentWordIndex).map(w => `<span class='done'>${w}</span>`).join(" ");
  const current = visible[0] || "";
  const typed = input.value;

  let currentHtml = "";
  for (let i = 0; i < current.length; i++) {
    const c = current[i];
    const t = typed[i] || "";
    if (t === "") currentHtml += `<span>${c}</span>`;
    else if (t === c) currentHtml += `<span class='correct'>${c}</span>`;
    else currentHtml += `<span class='incorrect'>${c}</span>`;
  }
  const rest = visible.slice(1).join(" ");
  textDisplay.innerHTML = [done, `<span class='current-word'>${currentHtml}</span>`, rest].join(" ");
}

function startTimer() {
  timer = setInterval(() => {
    timeLeft--;
    timeDisplay.textContent = timeLeft;
    if (timeLeft <= 0) endGame();
  }, 1000);
}

function endGame() {
  clearInterval(timer);
  input.disabled = true;
  const totalTime = 60 - timeLeft || 1;
  const wpm = Math.round((correctCount / totalTime) * 60);
  const accuracy = Math.round((correctCount / (correctCount + incorrectCount)) * 100) || 0;
  const score = Math.round(correctCount * accuracy / 10);
  const record = { date: new Date().toLocaleString(), correct: correctCount, incorrect: incorrectCount, wpm, accuracy, wrongWords };
  history.unshift(record);
  if (history.length > 5) history.pop();
  localStorage.setItem("history", JSON.stringify(history));
  resultDisplay.innerHTML = `
    ğŸ‰ <b>Káº¿t thÃºc!</b><br>
    âš¡ WPM: <b>${wpm}</b> | ğŸ¯ Äá»™ chÃ­nh xÃ¡c: <b>${accuracy}%</b><br>
    ğŸ’¯ Äiá»ƒm: <b>${score}</b><br><br>
    âŒ Tá»« sai:<br> ${wrongWords.join(", ") || "KhÃ´ng cÃ³"}<br><br>
    ğŸ“œ Lá»‹ch sá»­:<br>${history.map(h => `ğŸ“… ${h.date} â†’ âœ… ${h.correct} | âŒ ${h.incorrect} | âš¡ ${h.wpm} | ğŸ¯ ${h.accuracy}%`).join("<br>")}
  `;
}

input.addEventListener("input", renderText);
input.addEventListener("keydown", e => {
  if (!started) { started = true; startTimer(); }
  if (e.key === " " || e.key === "Enter") {
    e.preventDefault();
    const typed = input.value.trim();
    if (!typed) return;
    const currentWord = words[currentWordIndex];
    if (typed === currentWord) { correctCount++; soundCorrect.play(); }
    else { incorrectCount++; soundWrong.play(); wrongWords.push(typed); }
    currentWordIndex++;
    correctDisplay.textContent = correctCount;
    incorrectDisplay.textContent = incorrectCount;
    input.value = "";
    renderText();
  }
});

function startGame() {
  words = generateWords(lang, mode);
  currentWordIndex = correctCount = incorrectCount = 0;
  timeLeft = 60; wrongWords = []; started = false;
  clearInterval(timer);
  input.disabled = false;
  input.value = "";
  resultDisplay.textContent = "";
  timeDisplay.textContent = "60";
  correctDisplay.textContent = "0";
  incorrectDisplay.textContent = "0";
  renderText();
  input.focus();
}

// ğŸ”Š Äiá»u khiá»ƒn Ã¢m lÆ°á»£ng
function updateVolumeDisplay() {
  volumeDisplay.textContent = Math.round(volume * 100) + "%";
  soundCorrect.volume = volume;
  soundWrong.volume = volume;
  localStorage.setItem("volume", volume.toString());
}
volumeUp.addEventListener("click", () => {
  volume = Math.min(1, volume + 0.1);
  updateVolumeDisplay();
});
volumeDown.addEventListener("click", () => {
  volume = Math.max(0, volume - 0.1);
  updateVolumeDisplay();
});
updateVolumeDisplay();

restartBtn.addEventListener("click", startGame);
langSwitch.addEventListener("change", () => { lang = langSwitch.value; startGame(); });
modeSwitch.addEventListener("change", () => { mode = modeSwitch.value; startGame(); });

// ğŸŒ“ Chuyá»ƒn cháº¿ Ä‘á»™ sÃ¡ng/tá»‘i
let dark = localStorage.getItem("darkMode") === "true";
function updateTheme() {
  if (dark) { document.body.classList.add("dark"); themeIcon.textContent = "ğŸŒ"; }
  else { document.body.classList.remove("dark"); themeIcon.textContent = "ğŸŒ™"; }
}
themeIcon.addEventListener("click", () => {
  dark = !dark; localStorage.setItem("darkMode", dark); updateTheme();
});
updateTheme();

// ğŸ” ÄÄƒng xuáº¥t
document.getElementById("logoutBtn").addEventListener("click", () => {
  if (confirm("Báº¡n cÃ³ cháº¯c muá»‘n Ä‘Äƒng xuáº¥t khÃ´ng?")) {
    localStorage.setItem("loggedIn", "false");
    alert("ÄÃ£ Ä‘Äƒng xuáº¥t thÃ nh cÃ´ng!");
    window.location.href = "login.html";
  }
});

startGame();
</script>
</body>
</html>
